<?php	class AdminAdvFieldController extends Controller {			public static function listOfFields($r, $v) {			self::renderTemplate('advertisement'. ds . 'fields' . ds . 'adv-field-list.tpl', Array(				'fields' => AdvertisementStructureModel::getFields()			));		}				public static function removeField($r, $v) {						$fieldId = $v['field_id'];						if (AdvertisementStructureModel::removeField($fieldId)) echo json_encode(Array(				'success' => true			));					}				public static function removeFieldItem($r, $v) {					$rId = $v['r_id'];			if (AdvertisementStructureModel::removeFieldItem($rId)) echo json_encode(Array(				'success' => true			));					}				public static function edit($r, $v) {			self::renderTemplate('advertisement'. ds . 'fields' . ds .'adv-edit-field.tpl', Array(				'field' => AdvertisementStructureModel::getField($v['field_id']),				'imagesUrl' => Application::$settings['url'] . '/public/advertisement/field-item-data-images'			));					}				public static function doEdit($r, $v) {						$fieldId = $v['field_id'];						$imageDest = app_root . ds . 'public' . ds . 'advertisement' . ds . 'field-item-data-images' . ds;						// edit field			$fieldName = $_POST['fieldName'];			$type = $_POST['fieldType'];						AdvertisementStructureModel::setFieldItem($fieldId, $fieldName, $type);						// edit old fieldItems			$lastIndex = 0;			foreach($_POST['fieldValueId'] as $k => $f) {								$oldImage = "";								$id = $f;				$value = $_POST['fieldValue'][$k];								$f = AdvertisementStructureModel::getFieldItemValue($id);				$oldImage = $imageDest . ds . $f['image'];								foreach (Application::$settings['languages'] as $langIso => $lang) {					$title = $_POST['fieldMessage'][$langIso][$k];										$image = "";										if ($_FILES['fieldImage']['error'][$k] == '0') {						$image = $_FILES['fieldImage']['name'][$k];						move_uploaded_file($_FILES['fieldImage']['tmp_name'][$k], $imageDest . $image);												// remove old image						if (file_exists($oldImage)) unlink($oldImage);					}										AdvertisementStructureModel::setFieldItemValue($id, $langIso, $title, $value, $image);				}								$lastIndex = intval($k);			}						$c = count($_POST['newFields']) + $lastIndex + 1;						if (count($_POST['newFields'])) {				$k = $lastIndex;				while ($k < $c) {									$value = $_POST['fieldValue'][$k];										$rId = BaseModel::getLastId('brj_field_item_value') + 1;										foreach (Application::$settings['languages'] as $langIso => $lang) {						$title = $_POST['fieldMessage'][$langIso][$k];												$image = "";												if ($_FILES['fieldImage']['error'][$k] == '0') {							$image = $_FILES['fieldImage']['name'][$k];							move_uploaded_file($_FILES['fieldImage']['tmp_name'][$k], $imageDest . $image);														// remove old image							if (file_exists($oldImage)) unlink($oldImage);						}												AdvertisementStructureModel::addFieldItemValueEdit($rId, $langIso, $title, $value, $image, $fieldId);					}									$k++;				}			}						// add new items						echo json_encode(Array(				'success' => true			));		}				public static function add($r, $v) {			self::renderTemplate('advertisement'. ds . 'fields' . ds .'adv-add-field.tpl', Array());		}				public static function addSubmitted($r, $v) {						// add field to db			$fieldTitle = Security::filterSql(Security::filterString($_POST['fieldName']), BaseModel::$mysqli);			$fieldType = intval(Security::filterSql(Security::filterString($_POST['fieldType']), BaseModel::$mysqli));			$fieldId = AdvertisementStructureModel::addFieldItem($fieldTitle, $fieldType);						$imageDest = app_root . ds . 'public' . ds . 'advertisement' . ds . 'field-item-data-images' . ds;						$multiSelectFields = Array(2, 3, 4);			if (in_array($fieldType, $multiSelectFields)) {				if (count($_POST['fieldValue']) > 0) {									foreach ($_POST['fieldValue'] as $k => $v) {						$value = $_POST['fieldValue'][$k];												$image = "";						// get Image name						if ($_FILES['fieldImage']['error'][$k] == '0') {							$image = $_FILES['fieldImage']['name'][$k];							move_uploaded_file($_FILES['fieldImage']['tmp_name'][$k], $imageDest . $image);						}												$rId = BaseModel::getLastId('brj_field_item_value');						$rId++;												foreach (Application::$settings['languages'] as $langIso => $langTitle) {							$title = $_POST['fieldMessage'][$langIso][$k];							AdvertisementStructureModel::addFieldItemValue($rId, $fieldId, $title, $value, $langIso, $image);						}					}								}			}											}		}?>