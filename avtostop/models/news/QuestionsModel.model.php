<?php	class QuestionsModel extends CRUDModel {		public $r_id;		public $lang_id;		public $itemTitle;        public $email;        public $answered;        public $filesLinks;		//public $content;		//public $image;		//public $smallImage;		//public $date;		//public $forLoggedIn;		public static $tplViewFile;		public static $multiLang = true;		public function __construct() {			$this->r_id = new stdClass();			$this->r_id->value = null;			$this->lang_id = new stdClass();			$this->lang_id->value = null;			$messages = Application::$messages['model_news'];			$this->itemTitle = new ModelTextField("itemTitle", "Sual", true, true);			$this->itemTitle->required = false;            $this->filesLinks = new ModelTextField("filesLinks", "Fayllar", true, true);            $this->filesLinks->required = false;            $this->email = new ModelTextField("email", "E-mail", true, true);            $this->email->required = false;			$this->content = new ModelTinyMce("content", $messages['field_content'], true, true);			$this->content->required = false;			$this->image = new ModelFMImageField("image", Application::$messages['model_news']['field_image'], false, true);			$this->image->required = false;			$this->image->common = true;			$this->smallImage = new ModelFMImageField("smallImage", Application::$messages['model_news']['field_smallImage'], false, true);			$this->smallImage->required = false;			$this->smallImage->common = true;			$this->date = new ModelDateField("date", $messages['field_date'], true, true);			$this->date->common = true;            $this->answered = new ModelSelectField("answered", "Cavablandırılıb", Array(                '0' => Application::$messages['common_messages']['nno'],                '1' => Application::$messages['common_messages']['yyes'],            ), true, true);            $this->answered->common = true;			$this->forLoggedIn = new ModelSelectField("forLoggedIn", $messages['field_forLoggedIn'], Array(				'0' => Application::$messages['common_messages']['nno'],				'1' => Application::$messages['common_messages']['yyes'],			), true, true);			$this->forLoggedIn->common = true;		}		public function getSearchUrl() {			return 'news/view/' . $this->r_id->value;		}		public static function initialize() {			self::$displayFields = Array('itemTitle', 'email', 'answered', 'filesLinks');			self::$title = 'Suallar';			self::$iconPath = 'competitionQuestion.png';			self::$multiLang = true;			self::$searchable = false;			self::$viewUrl = 'news';			self::$searchSettings = Array(				'title_field' => 'itemTitle',				'content_field' => 'content',			);		}		public static function getLastNews($count, $lang = false) {			$sql = "";			$values = Array();			if (self::$multiLang && $lang) {				$sql .= " WHERE `lang_id` = '{#1}'";				$values[] = $lang;			}			if (!Application::$storage['logged_in']) {				$sql .= " AND `forLoggedIn` <> '1' ";			}			$sql .= "ORDER BY `date` DESC LIMIT ". intval($count);			$news = self::find($sql, $values);			$c = count($news);			for ($i = 0; $i < $c; $i++) {				$news[$i]->description = Utils::parseWords($news[$i]->content->value, 1);			}			return $news;		}		public static function getNewsWithCommentsCount($lang, $start, $limit) {			$sql = "SELECT `vl1_NewsModel`.*, count(`vl1_NewsCommentsModel`.`newsId`) as `comments_count`			FROM `vl1_NewsModel`			LEFT JOIN `vl1_NewsCommentsModel` ON `vl1_NewsModel`.`r_id` = `vl1_NewsCommentsModel`.`newsId` 			WHERE `vl1_NewsModel`.`lang_id` = '{#1}' AND `vl1_NewsModel`.`itemTitle` <> '' 			GROUP BY `vl1_NewsModel`.`itemTitle` LIMIT " . ($start * $limit) . "," . $limit;			$r = self::fQuery($sql, Array($lang));			$c = count($r);			for ($i = 0; $i < $c; $i++) {				$r[$i]['description'] = Utils::parseWords($r[$i]['content'], 1);			}			return $r;		}		public static function getNewsList($lang, $start, $limit) {			$sql = "SELECT `vl1_NewsModel`.*			FROM `vl1_NewsModel` 			WHERE 			`vl1_NewsModel`.`lang_id` = '{#1}' 			AND `vl1_NewsModel`.`itemTitle` IS NOT NULL 			AND trim(`vl1_NewsModel`.`itemTitle`) <> '' ";			if (!Application::$storage['logged_in']) {				$sql .= " AND `forLoggedIn` <> '1' ";			}			$sql .= " ORDER BY `vl1_NewsModel`.`date` DESC			LIMIT " . ($start * $limit) . "," . $limit;			$r = self::fQuery($sql, Array($lang));			$c = count($r);			for ($i = 0; $i < $c; $i++) {				$r[$i]['description'] = Utils::parseWords($r[$i]['content'], 1);				$r[$i]['url'] = self::getUrl($r[$i]['r_id'], $r[$i]['itemTitle']);			}			return $r;		}		private static function getUrl($id, $title) {			return Application::$settings['url'] . '/' . Application::$storage['lang'] . '/news/view/' . $id . '/' . Utils::translitUrl($title);		}		public static function getNews($newsId, $lang) {			$news = NewsModel::get($newsId, $lang);			$sql = "				SELECT `vl1_NewsCommentsModel`.`commentText`,`vl1_NewsCommentsModel`.`date`, `vl1_SiteUsersModel`.* 				FROM `vl1_NewsCommentsModel`				INNER JOIN `vl1_SiteUsersModel` 				ON `vl1_NewsCommentsModel`.`userId` = `vl1_SiteUsersModel`.`id` 				WHERE `vl1_NewsCommentsModel`.`newsId` = '{#1}'			";			if (!Application::$storage['logged_in']) {				$sql .= " AND `forLoggedIn` <> '1' ";			}			$comments = self::fQuery($sql, Array($newsId));			return Array(				'news' => $news,				'comments' => $comments,			);		}        public static function addQuestion($lang, $r_id, $question, $email) {            $sql = "INSERT INTO `".QuestionsModel::getTableName()."` (`lang_id`, `r_id`, `itemTitle`, `email`)                    VALUES('".$lang."', '".$r_id."', '".$question."', '".$email."')";            $result = self::fQuery($sql);            return $result;        }		public static function setAnswered($model_item_id) {		    $sql = "UPDATE `".QuestionsModel::getTableName()."` SET `answered` = '1' WHERE `r_id` = '".$model_item_id ."'";			$result = self::fQuery($sql);			return $result;		}        public static function assignFilesLinks($email, $links) {            $sql = "UPDATE `".QuestionsModel::getTableName()."` SET `filesLinks` = '".$links."' WHERE `email` = '".$email."'";            $result = self::fQuery($sql);            return $result;        }	}?>