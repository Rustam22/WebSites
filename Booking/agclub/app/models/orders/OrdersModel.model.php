<?php	class OrdersModel extends CRUDModel {		public $name;		public $phoneNumber;		public $address;		public $products;		public $time;		public $ip;		public $orderStatus;				public static $tplViewFile;				public static $ordersStatus;				public function __construct() {			$this->name = new ModelTextField("name", Application::$messages['model_orders']['field_name'], true, false);			$this->phoneNumber = new ModelTextField("phoneNumber", Application::$messages['model_orders']['field_phoneNumber'], true, false);			$this->address = new ModelTextField("address", Application::$messages['model_orders']['field_address'], true, false);			$this->products = new ModelTextField("products", Application::$messages['model_orders']['field_products'], true, false);			$this->products->hidden = true;			$this->time = new ModelTextField("time", Application::$messages['model_orders']['field_time'], true, false);			$this->time->hidden = true;			$this->ip = new ModelTextField("ip", Application::$messages['model_orders']['field_ip'], true, false);			$this->ip->hidden = true;			$this->orderStatus = new ModelSelectField("orderStatus", Application::$messages['model_orders']['field_order_status'], self::$ordersStatus, true, false);		}				public static function initialize() {			self::$title = Application::$messages['model_orders']['title'];			self::$iconPath = 'orders.png';			self::$tplViewFile = 'orders' . ds . 'view_orders.tpl';			self::$useOwnViewUrl = false;						self::$ordersStatus = Array(				1 => Application::$messages['model_orders']['os_received'],				2 => Application::$messages['model_orders']['os_paid'],				3 => Application::$messages['model_orders']['os_sent'],				4 => Application::$messages['model_orders']['os_delivered'],				5 => Application::$messages['model_orders']['os_return'],				6 => Application::$messages['model_orders']['os_delayed'],				7 => Application::$messages['model_orders']['os_cancelled']			);		}				public static function getOrdersCountByStatus($status) {			return self::count(" WHERE `orderStatus` = '{#1}'", Array($status));		}				public static function view($request, &$smarty, $vars = Array()) {			$orders = OrdersModel::find(" ORDER BY `orderStatus` ASC");			$data = Array();			$c = count($orders);			for ($i = 0; $i < $c; $i++) {				$orders[$i]->time->value = date("F j, Y, g:i a", $orders[$i]->time->value);								$data[$orders[$i]->orderStatus->value][$i]['order'] = $orders[$i];				$data[$orders[$i]->orderStatus->value][$i]['products'] = Array();								$productsId = explode(",", $orders[$i]->products->value);				$pC = count($productsId);				$totalPrice = 0;				for ($j = 1; $j < $pC - 1; $j++) {					$productInfo = explode(":", $productsId[$j]);					$productId = $productInfo[0];					$productCount = $productInfo[1];					$product = ProductModel::get($productId);					if ($product) {						$product->count = $productCount;						$totalPrice += $product->price->value * $productCount;						$data[$orders[$i]->orderStatus->value][$i]['products'][] = $product;					}				}				$data[$orders[$i]->orderStatus->value][$i]['totalPrice'] = $totalPrice;			}			return Array(				'orders' => $data,				'ordersStatus' => self::$ordersStatus			);		}	}?>